# meta developer: @your_username
# scope: hikka_only

from .. import loader, utils
import re

@loader.tds
class RVReplacer(loader.Module):
    """–ê–≤—Ç–æ–∑–∞–º–µ–Ω–∞ —Ä–≤ –Ω–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã"""
    
    strings = {"name": "RVReplacer"}
    
    def __init__(self):
        self.enabled = True
    
    async def client_ready(self, client, db):
        self.client = client
        self.db = db
    
    async def watcher(self, message):
        """–°–ª–µ–¥–∏–º –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏"""
        if not self.enabled:
            return
        
        # –¢–æ–ª—å–∫–æ –Ω–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        if not message.out:
            return
        
        # –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        if not message.text:
            return
        
        # –ò—â–µ–º '—Ä–≤' –≤ —Ç–µ–∫—Å—Ç–µ
        if "—Ä–≤" in message.text.lower():
            # –ó–∞–º–µ–Ω—è–µ–º
            new_text = re.sub(
                r'(?i)\b—Ä–≤\b',  # –ò—â–µ–º —Ü–µ–ª–æ–µ —Å–ª–æ–≤–æ '—Ä–≤' (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω)
                '+79902136543 –ü–°–ë –ë–∞–Ω–∫\n–í–∞—Å–∏–ª–∏–π –ö',
                message.text
            )
            
            # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è
            if new_text != message.text:
                try:
                    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    await message.edit(new_text)
                except Exception as e:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                    pass
    
    @loader.command()
    async def rvon(self, message):
        """–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-–∑–∞–º–µ–Ω—É"""
        self.enabled = True
        await utils.answer(message, "‚úÖ –ê–≤—Ç–æ-–∑–∞–º–µ–Ω–∞ '—Ä–≤' –≤–∫–ª—é—á–µ–Ω–∞")
    
    @loader.command()
    async def rvoff(self, message):
        """–í—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-–∑–∞–º–µ–Ω—É"""
        self.enabled = False
        await utils.answer(message, "‚èπÔ∏è –ê–≤—Ç–æ-–∑–∞–º–µ–Ω–∞ '—Ä–≤' –≤—ã–∫–ª—é—á–µ–Ω–∞")
    
    @loader.command()
    async def rvtest(self, message):
        """–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ–Ω—É"""
        test_text = "—Ä–≤ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–≤ —Ç–µ—Å—Ç"
        new_text = re.sub(r'(?i)\b—Ä–≤\b', '+79902136543 –ü–°–ë –ë–∞–Ω–∫\n–í–∞—Å–∏–ª–∏–π –ö', test_text)
        
        await utils.answer(
            message,
            f"üß™ **–¢–µ—Å—Ç –∑–∞–º–µ–Ω—ã:**\n"
            f"**–ò—Å—Ö–æ–¥–Ω—ã–π:** `{test_text}`\n"
            f"**–ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã:**\n`{new_text}`"
        )
    
    @loader.command()
    async def rvstatus(self, message):
        """–°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è"""
        status = "üü¢ –í–ö–õ–Æ–ß–ï–ù–û" if self.enabled else "üî¥ –í–´–ö–õ–Æ–ß–ï–ù–û"
        await utils.answer(
            message,
            f"üìä **–°—Ç–∞—Ç—É—Å RVReplacer:** {status}\n"
            f"üîß **–§—É–Ω–∫—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç '—Ä–≤' –Ω–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã"
        )
